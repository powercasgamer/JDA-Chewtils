name: Build Project
on: [push, pull_request]

jobs:
  build:
    # Only run on PRs if the source branch is on someone else's repo
    if: ${{ github.event_name != 'pull_request' || github.repository != github.event.pull_request.head.repo.full_name }}
    runs-on: ubuntu-latest
    strategy:
      matrix:
        java: [8, 11, 17]
      fail-fast: true
steps:
  - name: "checkout repository"
    uses: actions/checkout@v3
    with:
      fetch-depth: 0
      submodules: true

  - name: Make wrapper executable
    run: |
      chmod +x gradlew

  - name: "validate gradle wrapper"
    uses: "gradle/wrapper-validation-action@v1"

  - name: "Setup JDK ${{ matrix.java }}"
    uses: actions/setup-java@v3
    with:
      distribution: "temurin"
      java-version: "${{ matrix.java }}"
      cache: "gradle"

  - name: "run gradle build"
    uses: "gradle/gradle-build-action@v2"
    with:
      cache-read-only: "${{ !startsWith(github.ref, 'refs/heads/master/') || github.event_name == 'pull_request' }}"
      arguments: "build --stacktrace"
